<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chủ</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/prettyPhoto.css" rel="stylesheet">
    <link href="css/price-range.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/sweetalert.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
</head>
<body>
    <div id="header-container">
        <!-- Header sẽ được chèn vào đây -->
    </div>

    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div id="slider-carousel" class="carousel slide" data-ride="carousel">
                    
                    <div class="carousel-inner">
                        <div style="padding: 0 50px;" class="item active">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/web/images/slider1.webp" class="girl img-responsive" alt="" />
                            </div>
                        </div>
                        <div style="padding: 0 50px;" class="item">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/web/images/slider2.jpg" class="girl img-responsive" alt="" />
                            </div>
                        </div>
                        <div style="padding: 0 50px;" class="item">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/web/images/slider3.webp" class="girl img-responsive" alt="" />
                            </div>
                        </div>
                        <div style="padding: 0 50px;" class="item">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/web/images/slider4.webp" class="girl img-responsive" alt="" />
                            </div>
                        </div>
                    </div>
                    
                    <a href="#slider-carousel" class="left control-carousel hidden-xs" data-slide="prev">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a href="#slider-carousel" class="right control-carousel hidden-xs" data-slide="next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</section><!--/slider-->

<!-- Main Content Section -->
<section>
    <div class="container">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-sm-3">
                <div class="left-sidebar">
                    <h2>Danh mục sản phẩm</h2>
                    <div class="panel-group category-products" id="accordian"><!--category-productsr-->
                        <!-- Danh mục sản phẩm (static example) -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#">Laptops</a></h4>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#">Phones</a></h4>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#">Accessories</a></h4>
                            </div>
                        </div>
                    </div><!--/category-products-->
                
                    <div class="brands_products"><!--brands_products-->
                        <h2>Thương hiệu sản phẩm</h2>
                        <div class="brands-name">
                            <ul class="nav nav-pills nav-stacked">
                                <!-- Danh sách thương hiệu sản phẩm (static example) -->
                                <li><a href="#">Apple</a></li>
                                <li><a href="#">Samsung</a></li>
                                <li><a href="#">Dell</a></li>
                            </ul>
                        </div>
                    </div><!--/brands_products-->
                </div>
            </div>
            
            <!-- Product Listings -->
            <div class="col-sm-9 padding-right">
                <div class="features_items">
                    <h2 class="title text-center">Sản phẩm mới nhất</h2>

                    <!-- Sản phẩm (static example) -->
                    <div class="col-sm-4">
                        <div class="product-image-wrapper">
                            <div class="single-products">
                                <div class="productinfo text-center">
                                    <form>
                                        <input type="hidden" value="1" class="cart_product_id_1">
                                        <input type="hidden" value="Laptop Apple" class="cart_product_name_1">
                                        <input type="hidden" value="product1.jpg" class="cart_product_image_1">
                                        <input type="hidden" value="15000000" class="cart_product_price_1">
                                        <input type="hidden" value="1" class="cart_product_qty_1">

                                        <a href="chi-tiet-san-pham-1.html">
                                            <img src="upload/product/product1.jpg" alt="" />
                                            <h2>15.000.000 VNĐ</h2>
                                            <p>Laptop Apple</p>
                                        </a>
                                        <button type="button" class="btn btn-default add-to-cart" data-id_product="1" name="add-to-cart"><i class="fa fa-shopping-cart"></i>Thêm giỏ hàng</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="product-image-wrapper">
                            <div class="single-products">
                                <div class="productinfo text-center">
                                    <form>
                                        <input type="hidden" value="2" class="cart_product_id_2">
                                        <input type="hidden" value="Phone Samsung" class="cart_product_name_2">
                                        <input type="hidden" value="product2.jpg" class="cart_product_image_2">
                                        <input type="hidden" value="8000000" class="cart_product_price_2">
                                        <input type="hidden" value="1" class="cart_product_qty_2">

                                        <a href="chi-tiet-san-pham-2.html">
                                            <img src="upload/product/product2.jpg" alt="" />
                                            <h2>8.000.000 VNĐ</h2>
                                            <p>Phone Samsung</p>
                                        </a>
                                        <button type="button" class="btn btn-default add-to-cart" data-id_product="2" name="add-to-cart"><i class="fa fa-shopping-cart"></i>Thêm giỏ hàng</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="product-image-wrapper">
                            <div class="single-products">
                                <div class="productinfo text-center">
                                    <form>
                                        <input type="hidden" value="3" class="cart_product_id_3">
                                        <input type="hidden" value="Tablet Samsung" class="cart_product_name_3">
                                        <input type="hidden" value="product3.jpg" class="cart_product_image_3">
                                        <input type="hidden" value="5000000" class="cart_product_price_3">
                                        <input type="hidden" value="1" class="cart_product_qty_3">

                                        <a href="chi-tiet-san-pham-3.html">
                                            <img src="upload/product/product3.jpg" alt="" />
                                            <h2>5.000.000 VNĐ</h2>
                                            <p>Tablet Samsung</p>
                                        </a>
                                        <button type="button" class="btn btn-default add-to-cart" data-id_product="3" name="add-to-cart"><i class="fa fa-shopping-cart"></i>Thêm giỏ hàng</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="footer-container"></div>

    <script>
        // Chèn Header
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            });

        // Chèn Footer
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });

        // Khi trang load, lấy query param 'order_id' từ URL và kiểm tra trong localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order_id');
            if (orderId) {
                fetchOrderDetails(orderId);
            } else {
                alert('Không tìm thấy ID đơn hàng!');
            }
        });

        // Hàm để gọi API lấy chi tiết đơn hàng
        function fetchOrderDetails(orderId) {
            // Kiểm tra xem dữ liệu đã được lưu trong localStorage chưa
            const storedOrder = localStorage.getItem(`order_${orderId}`);
            if (storedOrder) {
                console.log('Dữ liệu lấy từ localStorage');
                renderOrderDetails(JSON.parse(storedOrder));  // Render từ localStorage
            } else {
                // Nếu chưa có dữ liệu trong localStorage, gọi API
                console.log('Dữ liệu lấy từ API');
                fetch(`http://127.0.0.1:8000/api/orders/${orderId}`)
                    .then(response => response.json())
                    .then(data => {
                        // Lưu dữ liệu vào localStorage
                        localStorage.setItem(`order_${orderId}`, JSON.stringify(data));
                        renderOrderDetails(data);
                    })
                    .catch(error => {
                        console.error('Có lỗi khi gọi API:', error);
                    });
            }
        }

        // Hàm để render chi tiết đơn hàng vào trang
        function renderOrderDetails(order) {
            const orderDetailsDiv = document.getElementById('order-details');
            orderDetailsDiv.innerHTML = `
                <p><strong>Order ID:</strong> ${order.order_id}</p>
                <p><strong>User ID:</strong> ${order.user_id}</p>
                <p><strong>Order Date:</strong> ${order.order_date}</p>
                <p><strong>Status:</strong> ${order.status}</p>
                <p><strong>Total Amount:</strong> ${order.total_amount}</p>
                <p><strong>User Name:</strong> ${order.user_name}</p>
            `;

            // Render các sản phẩm (order items)
            const orderItemsList = document.getElementById('order-items');
            orderItemsList.innerHTML = '';  // Clear existing data

            order.order_items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.product_name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price}</td>
                    <td>${item.quantity * item.price}</td>
                `;
                orderItemsList.appendChild(row);
            });
        }
    </script>
</body>
</html>
