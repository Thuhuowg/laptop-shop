<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Management</title>
    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000/api/cart';

        // Fetch and display cart items
        async function fetchCart() {
            const response = await fetch(API_BASE_URL);
            const cartItems = await response.json();
            const cartList = document.getElementById('cart-list');
            cartList.innerHTML = '';

            cartItems.forEach(item => {
                const listItem = document.createElement('li');
                listItem.textContent = `Product ID: ${item.product_id}, Quantity: ${item.quantity}`;

                const updateButton = document.createElement('button');
                updateButton.textContent = 'Update';
                updateButton.onclick = () => showUpdateForm(item.id, item.quantity);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => deleteCartItem(item.id);

                listItem.appendChild(updateButton);
                listItem.appendChild(deleteButton);
                cartList.appendChild(listItem);
            });
        }

        // Add item to cart
        async function addCartItem(event) {
            event.preventDefault();

            const productId = document.getElementById('add-product-id').value;
            const quantity = document.getElementById('add-quantity').value;

            const response = await fetch(API_BASE_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ product_id: productId, quantity: parseInt(quantity) })
            });

            if (response.ok) {
                fetchCart();
            }
        }

        // Update cart item
        async function updateCartItem(event) {
            event.preventDefault();

            const itemId = document.getElementById('update-item-id').value;
            const quantity = document.getElementById('update-quantity').value;

            const response = await fetch(`${API_BASE_URL}/${itemId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ quantity: parseInt(quantity) })
            });

            if (response.ok) {
                fetchCart();
                document.getElementById('update-form').style.display = 'none';
            }
        }

        // Delete cart item
        async function deleteCartItem(itemId) {
            const response = await fetch(`${API_BASE_URL}/${itemId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                fetchCart();
            }
        }

        // Clear cart
        async function clearCart() {
            const response = await fetch(API_BASE_URL, {
                method: 'DELETE'
            });

            if (response.ok) {
                fetchCart();
            }
        }

        // Show update form
        function showUpdateForm(itemId, currentQuantity) {
            document.getElementById('update-form').style.display = 'block';
            document.getElementById('update-item-id').value = itemId;
            document.getElementById('update-quantity').value = currentQuantity;
        }

        document.addEventListener('DOMContentLoaded', fetchCart);
    </script>
</head>
<body>
    <h1>Cart Management</h1>

    <h2>Cart Items</h2>
    <ul id="cart-list"></ul>

    <h2>Add Item to Cart</h2>
    <form id="add-form" onsubmit="addCartItem(event)">
        <label for="add-product-id">Product ID:</label>
        <input type="text" id="add-product-id" required>
        <label for="add-quantity">Quantity:</label>
        <input type="number" id="add-quantity" min="1" required>
        <button type="submit">Add to Cart</button>
    </form>

    <h2>Update Item</h2>
    <form id="update-form" style="display: none;" onsubmit="updateCartItem(event)">
        <input type="hidden" id="update-item-id">
        <label for="update-quantity">Quantity:</label>
        <input type="number" id="update-quantity" min="1" required>
        <button type="submit">Update</button>
    </form>

    <h2>Clear Cart</h2>
    <button onclick="clearCart()">Clear Cart</button>
</body>
</html>
