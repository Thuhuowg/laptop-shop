<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | Laptop-Shoppe</title>
    <link href="/fe/css/bootstrap.min.css" rel="stylesheet">
    <link href="/fe/css/font-awesome.min.css" rel="stylesheet">
    <link href="/fe/css/prettyPhoto.css" rel="stylesheet">
    <link href="/fe/css/price-range.css" rel="stylesheet">
    <link href="/fe/css/animate.css" rel="stylesheet">
    <link href="/fe/css/sweetalert.css" rel="stylesheet">
    <link href="/fe/css/main.css" rel="stylesheet">
    <link href="/fe/css/responsive.css" rel="stylesheet">
</head>
<body>
    <div id="header-container"></div>

    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div id="slider-carousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner" id="slider-content">
                        <!-- Slide images -->
                        <div class="item active">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/fe/images/slider1.webp" class="girl img-responsive" alt="Slide 1" />
                            </div>
                        </div>
                        <div class="item">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/fe/images/slider2.jpg" class="girl img-responsive" alt="Slide 2" />
                            </div>
                        </div>
                        <div class="item">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/fe/images/slider3.webp" class="girl img-responsive" alt="Slide 3" />
                            </div>
                        </div>
                        <div class="item">
                            <div class="col-sm-12">
                                <img style="width: 100%;" src="/fe/images/slider4.webp" class="girl img-responsive" alt="Slide 4" />
                            </div>
                        </div>
                    </div>
                    <a href="#slider-carousel" class="left control-carousel hidden-xs" data-slide="prev">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a href="#slider-carousel" class="right control-carousel hidden-xs" data-slide="next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <section>
        <div class="container">
            <div class="row">
                <div class="col-sm-3">
                    <div class="left-sidebar">
                        <h2>Danh mục sản phẩm</h2>
                        <div class="panel-group category-products" id="accordian"><!--category-productsr-->
                            <!-- Danh mục sản phẩm (static example) -->
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title"><a href="#">Laptop Mới</a></h4>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title"><a href="#">Laptop Cũ</a></h4>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title"><a href="#">Trả Góp</a></h4>
                                </div>
                            </div>
                        </div><!--/category-products-->
                    
                        <div class="brands_products"><!--brands_products-->
                            <h2>Thương hiệu sản phẩm</h2>
                            <div class="brands-name">
                                <ul class="nav nav-pills nav-stacked">
                                    <!-- Danh sách thương hiệu sản phẩm (static example) -->
                                    <li><a href="#">MSI</a></li>
                                    <li><a href="#">HP</a></li>
                                    <li><a href="#">Dell</a></li>
                                </ul>
                            </div>
                        </div><!--/brands_products-->
                    </div>
                </div>

                <div class="col-sm-9 padding-right">
                    <div class="features_items">
                        <h2 class="title text-center">Sản phẩm mới nhất</h2>
                        <div id="products-list"></div> <!-- Products will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-container"></div>

    <script>
        // Chèn Header
        document.addEventListener("DOMContentLoaded", function () {
            fetch('../header/header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;

                    // Load header.js explicitly after header.html is fetched
                    const script = document.createElement('script');
                    script.src = '../header/header.js';
                    script.onload = () => {
                        if (typeof initializeHeader === 'function') {
                            initializeHeader(); // Call the function after header.js is loaded
                        } else {
                            console.error("initializeHeader function not found in header.js");
                        }
                    };
                    document.body.appendChild(script);

                    checkAndDisplayProductLink();
                })
                .catch(err => console.error("Error loading header.html:", err));
        });

        // Chèn Footer
        fetch('/fe/footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });

        

        // Gọi API cho Danh mục Sản phẩm
        fetch('http://127.0.0.1:8000/api/v1/categories')
            .then(response => response.json())
            .then(data => {
                const categoryContainer = document.getElementById('category-accordian');
                data.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.classList.add('panel', 'panel-default');
                    categoryItem.innerHTML = `
                        <div class="panel-heading">
                            <h4 class="panel-title"><a href="#">${category.name}</a></h4>
                        </div>
                    `;
                    categoryContainer.appendChild(categoryItem);
                });
            })
            .catch(error => console.log('Lỗi khi tải danh mục:', error));

        // Gọi API cho Thương hiệu Sản phẩm

        // Gọi API cho Sản phẩm Mới Nhất
        const loadProducts = () => {
        const storedProducts = localStorage.getItem('products');
        if (storedProducts) {
            const products = JSON.parse(storedProducts);
            renderProducts(products);
        } else {
            // Nếu không có, gọi API và lưu vào localStorage
            fetch('http://127.0.0.1:8000/api/v1/products')
                .then(response => response.json())
                .then(data => {
                    localStorage.setItem('products', JSON.stringify(data)); // Lưu vào localStorage
                    renderProducts(data); // Hiển thị sản phẩm
                })
                .catch(error => console.log('Lỗi khi tải sản phẩm:', error));
        }
    };

    // Hàm hiển thị sản phẩm
    const renderProducts = (products) => {
        const productsList = document.getElementById('products-list');
        productsList.innerHTML = ''; // Clear old products
        products.forEach(product => {
            const productItem = document.createElement('div');
            productItem.classList.add('col-sm-4');
            productItem.innerHTML = `
                <div class="product-image-wrapper">
                    <div class="single-products">
                        <div class="productinfo text-center">
                            <form>
                                <input type="hidden" value="${product.product_id}" class="cart_product_id_${product.product_id}">
                                <input type="hidden" value="${product.product_name}" class="cart_product_name_${product.product_id}">
                                <input type="hidden" value="${product.image_url}" class="cart_product_image_${product.product_id}">
                                <input type="hidden" value="${product.price}" class="cart_product_price_${product.product_id}">
                                <input type="hidden" value="1" class="cart_product_qty_${product.product_id}">

                                <a href="/fe/product-detail.html?product_id=${product.product_id}">
                                    <img src="/fe/images/product/${product.image_url}" alt="${product.product_name}" />
                                    <h2>${new Intl.NumberFormat('vi-VN').format(product.price)} VNĐ</h2>
                                    <p>${product.product_name}</p>
                                </a>

                                <button type="button" class="btn btn-default add-to-cart" data-id_product="${product.product_id}" name="add-to-cart">
                                    <i class="fa fa-shopping-cart"></i> Thêm giỏ hàng
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            productsList.appendChild(productItem);
        });
    };

    // Gọi hàm loadProducts khi trang được tải
    loadProducts();
    // Khởi tạo giỏ hàng từ localStorage
const initializeCart = () => {
    let cart = localStorage.getItem('cart');
    if (!cart) {
        localStorage.setItem('cart', JSON.stringify([]));
    }
};

// Hàm thêm sản phẩm vào giỏ hàng
const addToCart = (product) => {
    let cart = JSON.parse(localStorage.getItem('cart'));
    const existingProductIndex = cart.findIndex(item => item.id === product.id);

    if (existingProductIndex !== -1) {
        // Nếu sản phẩm đã tồn tại trong giỏ hàng, tăng số lượng
        cart[existingProductIndex].quantity += product.quantity;
    } else {
        // Nếu sản phẩm chưa có trong giỏ hàng, thêm vào
        cart.push(product);
    }

    localStorage.setItem('cart', JSON.stringify(cart));
    alert(`Đã thêm "${product.name}" vào giỏ hàng!`);
};

// Bắt sự kiện khi click vào nút "Thêm giỏ hàng"
document.addEventListener('click', (event) => {
    if (event.target && event.target.classList.contains('add-to-cart')) {
        const button = event.target;
        const productId = button.getAttribute('data-id_product');
        
        // Lấy thông tin sản phẩm từ các input hidden
        const product = {
            id: productId,
            name: document.querySelector(`.cart_product_name_${productId}`).value,
            image: document.querySelector(`.cart_product_image_${productId}`).value,
            price: parseFloat(document.querySelector(`.cart_product_price_${productId}`).value),
            quantity: parseInt(document.querySelector(`.cart_product_qty_${productId}`).value),
        };

        // Thêm sản phẩm vào giỏ hàng
        addToCart(product);
    }
});

// Khởi tạo giỏ hàng khi tải trang
initializeCart();
    </script>

</body>
</html>
